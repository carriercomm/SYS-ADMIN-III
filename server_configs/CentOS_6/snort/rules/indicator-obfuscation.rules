# Copyright 2001-2012 Sourcefire Inc. All Rights Reserved.
#
# This file may contain proprietary rules that were created, tested and
# certified by Sourcefire, Inc. (the "VRT Certified Rules") as well as
# rules that were created by Sourcefire and other third parties and
# distributed under the GNU General Public License (the "GPL Rules").  The
# VRT Certified Rules contained in this file are the property of
# Sourcefire, Inc. Copyright 2012 Sourcefire, Inc. All Rights Reserved.
# The GPL Rules created by Sourcefire, Inc. are the property of
# Sourcefire, Inc. Copyright 2002-2012 Sourcefire, Inc. All Rights
# Reserved.  All other GPL Rules are owned and copyrighted by their
# respective owners (please see www.snort.org/contributors for a list of
# owners and their respective copyrights).  In order to determine what
# rules are VRT Certified Rules or GPL Rules, please refer to the VRT
# Certified Rules License Agreement.
#
#-----------------------------
# INDICATOR-OBFUSCATION RULES
#-----------------------------

# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION String.fromCharCode with multiple encoding types detected"; flow:to_client,established; file_data; content:"String.fromCharCode"; fast_pattern:only; pcre:"/String\x2efromCharCode\s*\x28[^\x29]*0x[0-9a-f]{2}\s*,[^\x29]*,\s*0[0-7]{1,3}\s*,[^\x29]*,\s*[1-9][0-9]{0,2}\s*,/smi"; metadata:service http; classtype:policy-violation; sid:19884; rev:5;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION randomized javascript encodings detected"; flow:to_client,established; file_data; content:"script"; content:"%u"; pcre:"/%u[0-9a-f]{2}[^\x29]*%[0-9a-f]{2}[^\x29]*%u[0-9a-f]{2}[^\x29]*%[0-9a-f]{2}/"; metadata:service http; classtype:policy-violation; sid:19867; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION potential javascript unescape obfuscation attempt detected"; flow:to_client,established; file_data; content:".write"; content:"unescape"; pcre:"/\x2ewrite\s*\x28\s*unescape\s*\x28/smi"; metadata:service http; classtype:policy-violation; sid:19887; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION base64-encoded data object found"; flow:to_client,established; file_data; content:"data"; nocase; content:"text/html"; within:20; nocase; content:"base64"; within:20; fast_pattern; nocase; pcre:"/data\s*\x3a\s*text\x2fhtml\s*\x3b\s*base64\s*,/smi"; metadata:policy security-ips drop, service http; reference:url,tools.ietf.org/html/rfc2397; classtype:policy-violation; sid:19889; rev:6;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION potential javascript unescape obfuscation attempt detected"; flow:to_client,established; file_data; content:".write"; content:"unescape"; fast_pattern:only; pcre:"/var\s+([^\s]+)\s*=\s*unescape\s*\x28.*?\x2ewrite\s*\x28\s*\1/smi"; metadata:service http; classtype:policy-violation; sid:19888; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION standard ASCII encoded with UTF-8 possible evasion detected"; flow:to_client,established; content:"charset"; nocase; http_header; content:"utf-8"; fast_pattern:only; http_header; pcre:"/charset\s*=\s*utf-8/smiH"; file_data; pcre:"/([\xc0-\xc1][\x80-\xbf]){10}/"; metadata:service http; classtype:policy-violation; sid:20276; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION potential javascript unescape obfuscation attempt detected"; flow:to_client,established; content:".write"; content:"unescape"; pcre:"/\x2ewrite\s*\x28\s*unescape\s*\x28/smi"; content:"%"; distance:0; content:"%"; within:1; distance:2; content:"%"; within:1; distance:2; metadata:service http; classtype:policy-violation; sid:21039; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION potential javascript unescape obfuscation attempt detected"; flow:to_client,established; content:".write"; content:"unescape"; fast_pattern:only; pcre:"/var\s+([^\s]+)\s*=\s*unescape\s*\x28.*?\x2ewrite\s*\x28\s*\1/smi"; metadata:service http; classtype:policy-violation; sid:21040; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION String.fromCharCode with multiple encoding types detected"; flow:to_client,established; content:"String.fromCharCode"; fast_pattern:only; pcre:"/String\x2efromCharCode\s*\x28[^\x29]*0x[0-9a-f]{2}\s*,[^\x29]*,\s*0[0-7]{1,3}\s*,[^\x29]*,\s*[1-9][0-9]{0,2}\s*,/smi"; metadata:service http; classtype:policy-violation; sid:21038; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION rename of JavaScript unescape function - likely malware obfuscation"; flow:to_client,established; content:"var "; nocase; content:"unescape"; within:100; distance:5; nocase; pcre:"/var\s+[A-Z][A-Z\d\x5F]{5,}\s*=\s*unescape[\s\x3b]/smi"; metadata:policy security-ips drop, service http; classtype:attempted-user; sid:17400; rev:9;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Dadongs obfuscated javascript"; flow:to_client,established; file_data; content:"(|22|dadongs=|22|)"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; reference:url,www.kahusecurity.com/2012/chinese-pack-using-dadongs-jsxx-vip-script/; classtype:misc-activity; sid:21519; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION randomized javascript encodings detected"; flow:to_client,established; content:"script"; content:"%u"; pcre:"/%u[0-1][0-9a-f]{2}[^\x29]*%u[0-1][0-9a-f]{2}[^\x29]*%u[0-1][0-9a-f]{2}[^\x29]*%u[0-1][0-9a-f]{2}/"; metadata:service http; classtype:policy-violation; sid:21037; rev:5;)
# alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION oversized cast statement - possible sql injection obfuscation"; flow:established,to_server; content:"CAST|28|"; nocase; isdataat:250,relative; content:!"|29|"; within:250; metadata:policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:13791; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION large number of calls to char function - possible sql injection obfuscation"; flow:established,to_server; content:"POST"; http_method; content:"CHAR("; nocase; http_uri; pcre:"/[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(/smiU"; metadata:policy balanced-ips drop, policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:13989; rev:7;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION oversized convert statement - possible sql injection obfuscation"; flow:established,to_server; content:"CONVERT|28|"; nocase; isdataat:250,relative; content:!"|29|"; within:250; metadata:policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:13987; rev:4;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION large number of calls to concat function - possible sql injection obfuscation"; flow:established,to_server; content:"CONCAT|28|"; nocase; content:"CONCAT|28|"; distance:0; nocase; content:"CONCAT|28|"; distance:0; nocase; content:"CONCAT|28|"; distance:0; nocase; content:"CONCAT|28|"; distance:0; nocase; metadata:policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:14008; rev:4;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION large number of calls to ascii function - possible sql injection obfuscation"; flow:established,to_server; content:"ASCII|28|"; nocase; content:"ASCII|28|"; distance:0; nocase; content:"ASCII|28|"; distance:0; nocase; content:"ASCII|28|"; distance:0; nocase; content:"ASCII|28|"; distance:0; nocase; metadata:policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:13988; rev:4;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION select concat statement - possible sql injection obfuscation"; flow:established,to_server; content:"select concat|28|"; nocase; http_uri; metadata:service http; reference:url,ferruh.mavituna.com/sql-injection-cheatsheet-oku/; classtype:web-application-attack; sid:19437; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION obfuscated javascript excessive fromCharCode - potential attack"; flow:to_client,established; file_data; content:"String.fromCharCode|28|"; nocase; content:"String.fromCharCode|28|"; within:100; nocase; content:"String.fromCharCode|28|"; within:100; nocase; content:"String.fromCharCode|28|"; within:100; nocase; content:"String.fromCharCode|28|"; within:100; nocase; metadata:policy security-ips drop, service http; reference:url,cansecwest.com/slides07/csw07-nazario.pdf; reference:url,www.cs.ucsb.edu/~marco/blog/2008/10/dom-based-obfuscation-in-malicious-javascript.html; classtype:misc-activity; sid:15362; rev:8;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Potential obfuscated javascript eval unescape attack attempt"; flow:to_client,established; content:"eval|28|"; nocase; content:"unescape|28|"; within:15; nocase; content:!"|29|"; within:250; metadata:policy security-ips drop, service http; reference:url,cansecwest.com/slides07/csw07-nazario.pdf; reference:url,www.cs.ucsb.edu/~marco/blog/2008/10/dom-based-obfuscation-in-malicious-javascript.html; classtype:misc-activity; sid:15363; rev:5;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Generic javascript obfuscation attempt"; flow:to_client,established; file_data; content:"unescape"; nocase; pcre:"/var[^=]+=\s*unescape\s*\x3b/i"; metadata:policy security-ips drop, service http; reference:bugtraq,35660; classtype:attempted-user; sid:15697; rev:5;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION known JavaScript obfuscation routine"; flow:to_client,established; content:"String.fromCharCode|28|parseInt"; content:"String.fromCharCode|28|"; within:1000; content:".charCodeAt|28|"; within:100; content:".replace"; within:100; pcre:"/\.replace\x28\x2F[^\x2F]+\x2F[A-Z]*\x2C(\x22\x22|\x27\x27)/smi"; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:attempted-user; sid:17111; rev:6;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION hidden 1x1 div tag - potential malware obfuscation"; flow:to_client,established; file_data; content:"<div style=|22|overflow|3A|hidden|3B|width|3A|1px|3B|height|3A|1px|3B 22|>"; fast_pattern:only; metadata:policy security-ips drop, service http; classtype:misc-activity; sid:19868; rev:6;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION generic PHP code obfuscation attempt"; flow:established,to_server; content:"Array|28|"; content:"|20 20 20 20 2E|"; within:200; metadata:service http; classtype:trojan-activity; sid:18493; rev:4;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION malware-associated JavaScript obfuscation function"; flow:to_client,established; file_data; content:"function re|28|s,n,r,b,e|29|{if|28|s<b|7C 7C|s>e|29|return s|3B|"; fast_pattern:only; metadata:service http; reference:url,labs.snort.org/docs/18132.html; classtype:trojan-activity; sid:18132; rev:6;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript obfuscation - eval"; flow:to_client,established; file_data; content:"|22|eva|22|+|22|l|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:21578; rev:4;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript obfuscation - charcode"; flow:to_client,established; file_data; content:"|22|c|22|+|22|h|22|+|22|ar|22|+|22|Code|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:21577; rev:4;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript obfuscation - fromCharCode"; flow:to_client,established; file_data; content:"|22|from|22|+|22|CharCod|22|+|22|e|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:21580; rev:3;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript obfuscation - fromCharCode"; flow:to_client,established; file_data; content:"|22|fromCharCod|22|+|22|e|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:21579; rev:4;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Microsoft Office Word JavaScript obfuscation - charCode"; flow:to_client,established; flowbits:isset,file.doc; file_data; content:"O|00|C|00|X|00|D|00|A|00|T|00|A|00|"; content:"j|00|a|00|v|00|a|00|s|00|c|00|r|00|i|00|p|00|t|00|"; distance:0; nocase; content:"c|00|h|00|a|00|r|00|C|00|o|00|d|00|e|00|"; distance:0; nocase; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:22074; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Microsoft Office Word JavaScript obfuscation - unescape"; flow:to_client,established; flowbits:isset,file.doc; file_data; content:"O|00|C|00|X|00|D|00|A|00|T|00|A|00|"; content:"j|00|a|00|v|00|a|00|s|00|c|00|r|00|i|00|p|00|t|00|"; distance:0; nocase; content:"u|00|n|00|e|00|s|00|c|00|a|00|p|00|e|00|"; distance:0; nocase; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:22073; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Microsoft Office Word JavaScript obfuscation - fromCharCode"; flow:to_client,established; flowbits:isset,file.doc; file_data; content:"O|00|C|00|X|00|D|00|A|00|T|00|A|00|"; content:"j|00|a|00|v|00|a|00|s|00|c|00|r|00|i|00|p|00|t|00|"; distance:0; nocase; content:"f|00|r|00|o|00|m|00|C|00|h|00|a|00|r|00|C|00|o|00|d|00|e|00|"; distance:0; nocase; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:22072; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Microsoft Office Word JavaScript obfuscation - eval"; flow:to_client,established; flowbits:isset,file.doc; file_data; content:"O|00|C|00|X|00|D|00|A|00|T|00|A|00|"; content:"j|00|a|00|v|00|a|00|s|00|c|00|r|00|i|00|p|00|t|00|"; distance:0; nocase; content:"e|00|v|00|a|00|l|00|"; distance:0; nocase; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:22071; rev:1;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION eval of base64-encoded data"; flow:to_client,established; file_data; content:"eval|28|base64_decode|28|"; fast_pattern:only; metadata:policy security-ips drop, service http, service imap, service pop3; classtype:trojan-activity; sid:23018; rev:3;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Obfuscated javascript string - qweqwe"; flow:to_client,established; file_data; content:"<qwe qweqwe=|27|asd|27|/>"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:bad-unknown; sid:23088; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Obfuscated javascript string - push"; flow:to_client,established; file_data; content:"a|3D 27|pus|27 2B 27|h|27 3B|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:bad-unknown; sid:23086; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Obfuscated javascript string - xval"; flow:to_client,established; file_data; content:"q|3D|x|2B 27|v|27 2B 27|al|27 3B|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:bad-unknown; sid:23087; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Obfuscated javascript string - join"; flow:to_client,established; file_data; content:"b|3D 22|j|22 2B 22|o|22 2B 27|i|27 3B|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:bad-unknown; sid:23085; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Obfuscated javascript strings - obfuscation pattern"; flow:to_client,established; file_data; content:"|3A|present>"; content:"|3A|interactive>1</"; distance:0; pcre:"/\x3c(?P<string>\w+)\x3apresent.*?\x3c(?P=string)\x3ainteractive.*?\x3c\x2f(?P=string)\x3ainteractive/smi"; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:bad-unknown; sid:23089; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION GIF header with PHP tags - likely malicious"; flow:to_client,established; file_data; content:"GIF89a"; depth:6; nocase; content:"<?php"; within:100; nocase; metadata:policy balanced-ips alert, policy security-ips drop, service http, service imap, service pop3; reference:url,labs.snort.org/docs/23114.txt; reference:url,vrt-blog.snort.org/2012/06/web-shell-poses-as-gif.html; classtype:misc-activity; sid:23114; rev:5;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION eval gzinflate base64_decode call - likely malicious"; flow:to_client,established; file_data; content:"eval|28|"; nocase; content:"gzinflate|28|"; within:25; nocase; content:"base64_decode|28|"; within:25; nocase; metadata:policy balanced-ips alert, policy security-ips drop, service http, service imap, service pop3; reference:url,labs.snort.org/docs/23113.txt; reference:url,vrt-blog.snort.org/2012/06/web-shell-poses-as-gif.html; classtype:misc-activity; sid:23113; rev:4;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Javascript obfuscation - eval"; flow:to_client,established; file_data; content:"|22|e|22|+|22|val|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:23161; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION Javascript obfuscation - fromCharCode"; flow:to_client,established; file_data; content:"|22|fromCharC|22|+|22|ode|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:attempted-user; sid:23160; rev:1;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript error suppression routine"; flow:to_client,established; file_data; content:"window.onerror = function|20 28 29 20 7B|return true"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http, service imap, service pop3; classtype:misc-activity; sid:23226; rev:3;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION hex escaped characters in addEventListener call"; flow:established,to_client; file_data; content:"addEventListener|28|"; nocase; content:"|5C|x"; within:10; nocase; content:"|5C|x"; within:10; nocase; pcre:"/addEventListener\x28[\x22\x27][^\x2C]*?\x5cx[\da-f]{2}[^\x2C]*?[\da-f]{2,}\x5cx[\da-f]{2}/smi"; metadata:ruleset community, service http, service imap, service pop3; classtype:bad-unknown; sid:23482; rev:3;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION hex escaped characters in setTimeout call"; flow:established,to_client; file_data; content:"setTimeout|28|"; nocase; content:"|5C|x"; within:10; nocase; content:"|5C|x"; within:10; nocase; pcre:"/setTimeout\x28[\x22\x27][^\x2C]*?\x5cx[\da-f]{2}[^\x2C]*?[\da-f]{2,}\x5cx[\da-f]{2}/smi"; metadata:ruleset community, service http, service imap, service pop3; classtype:bad-unknown; sid:23481; rev:3;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION known packer routine with secondary obfuscation"; flow:to_client,established; file_data; content:"eval(function(p,a,c,k,e,r)"; fast_pattern:only; content:"|7C|fromCharCode|7C|"; nocase; content:"|7C|charCodeAt|7C|"; distance:0; nocase; content:"|7C|eval|7C|"; distance:0; nocase; metadata:policy balanced-ips drop, policy security-ips drop, ruleset community, service http, service imap, service pop3; reference:url,dean.edwards.name/packer/; classtype:misc-activity; sid:23621; rev:4;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JavaScript built-in function parseInt appears obfuscated - likely packer or encoder"; flow:to_client,established; file_data; content:"|5B 27|parse|27 2B 27|Int|27 5D 28|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, ruleset community, service http, service imap, service pop3; reference:url,labs.snort.org/docs/23636.txt; classtype:trojan-activity; sid:23636; rev:6;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION base64-encoded uri data object found"; flow:to_client,established; file_data; content:"base64"; pcre:"/<\s*object[^>]*?data\s*\x3A[^,>]*?base64/smi"; metadata:policy balanced-ips drop, policy security-ips drop, service http; reference:url,tools.ietf.org/html/rfc2397; classtype:policy-violation; sid:17291; rev:4;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION script tag in POST parameters - likely cross-site scripting"; flow:to_server,established; content:"<script>"; fast_pattern:only; http_client_body; metadata:service http; classtype:web-application-attack; sid:21782; rev:5;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION javascript escape function in POST parameters - likely javascript injection"; flow:to_server,established; content:"escape("; fast_pattern:only; http_client_body; metadata:service http; classtype:web-application-attack; sid:21785; rev:5;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded union select function in POST - possible sql injection attempt"; flow:to_server,established; content:"%55%4e%49%4f%4e%20%53%45%4c%45%43%54"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips drop, service http; classtype:misc-attack; sid:21781; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded script tag in POST parameters - likely cross-site scripting"; flow:to_server,established; content:"|26 23|x3c|3B 26 23|x73|3B 26 23|x63|3B 26 23|x72|3B 26 23|x69|3B 26 23|x70|3B 26 23|x74|3B 26 23|x3e|3B|"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips drop, service http; classtype:web-application-attack; sid:21784; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded waitfor delay function in POST - possible sql injection attempt"; flow:to_server,established; content:"%77%61%69%74%66%6f%72%20%64%65%6c%61%79"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips drop, service http; classtype:misc-attack; sid:21780; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded script tag in POST parameters - likely cross-site scripting"; flow:to_server,established; content:"%3C%73%63%72%69%70%74%3E"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips alert, service http; classtype:web-application-attack; sid:21783; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded javascript escape function in POST parameters - likely javascript injection"; flow:to_server,established; content:"|26 23|x65|3B 26 23|x73|3B 26 23|x63|3B 26 23|x61|3B 26 23|x70|3B 26 23|x65|3B 26 23|x28"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips drop, service http; classtype:web-application-attack; sid:21787; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION encoded javascript escape function in POST parameters - likely javascript injection"; flow:to_server,established; content:"%65%73%63%61%70%65%28"; fast_pattern:only; http_client_body; metadata:policy balanced-ips alert, policy security-ips alert, service http; classtype:web-application-attack; sid:21786; rev:6;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION hidden iframe - potential include of malicious content"; flow:to_client, established; file_data; content:"<iframe "; nocase; content:"width=1"; within:50; nocase; content:"height=1"; within:80; distance:-40; nocase; content:"style=visibility|3A|hidden"; within:80; distance:-40; nocase; metadata:service http; reference:url,blog.unmaskparasites.com/2009/10/28/evolution-of-hidden-iframes/; classtype:bad-unknown; sid:24168; rev:2;)
alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION document write of unescaped value with remote script"; flow:to_client,established; file_data; content:"document.write|28|unescape|28 27|%3C%73%63%72%69%70%74%20%73%72%63%3D%22%68%74%74%70%3A%2F%2F"; fast_pattern:only; metadata:policy balanced-ips alert, policy security-ips drop, service http, service imap, service pop3; classtype:trojan-activity; sid:24167; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION ActiveX multiple adjacent object tags"; flow:to_client,established; file_data; content:"<object "; content:"classid"; within:50; content:"<object "; within:100; content:"classid"; within:50; content:"<object "; within:100; content:"classid"; within:50; content:"<object "; within:100; content:"classid"; within:50; content:"<object "; within:100; content:"classid"; within:50; metadata:policy security-ips drop, service http; classtype:misc-attack; sid:25060; rev:2;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION GIF header followed by PDF header"; flow:to_client,established; file_data; content:"GIF8"; depth:4; content:"a"; within:1; distance:1; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service http, service imap, service pop3; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25451; rev:1;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION DOC header followed by PDF header"; flow:to_client,established; file_data; content:"|D0 CF 11 E0|"; depth:4; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service http, service imap, service pop3; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25454; rev:1;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATOR-OBFUSCATION DOC header followed by PDF header"; flow:to_server,established; file_data; content:"|D0 CF 11 E0|"; depth:4; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service smtp; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25458; rev:2;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATOR-OBFUSCATION JPEG header followed by PDF header"; flow:to_server,established; file_data; content:"|FF D8 FF E0|"; depth:4; content:"|FA FF DA 00 0C|"; within:800; content:"%PDF-"; within:224; nocase; metadata:policy security-ips drop, service smtp; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25457; rev:2;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION JPEG header followed by PDF header"; flow:to_client,established; file_data; content:"|FF D8 FF E0|"; depth:4; content:"|FA FF DA 00 0C|"; within:800; content:"%PDF-"; within:224; nocase; metadata:policy security-ips drop, service http, service imap, service pop3; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25453; rev:1;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATOR-OBFUSCATION PNG header followed by PDF header"; flow:to_server,established; file_data; content:"|89|PNG|0D 0A 1A 0A|"; depth:8; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service smtp; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25456; rev:2;)
# alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION PNG header followed by PDF header"; flow:to_client,established; file_data; content:"|89|PNG|0D 0A 1A 0A|"; depth:8; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service http, service imap, service pop3; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25452; rev:1;)
# alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"INDICATOR-OBFUSCATION GIF header followed by PDF header"; flow:to_server,established; file_data; content:"GIF8"; depth:4; content:"a"; within:1; distance:1; content:"%PDF-"; within:1024; nocase; metadata:policy security-ips drop, service smtp; reference:cve,2013-0624; reference:url,www.adobe.com/support/security/bulletins/apsb13-02.html; classtype:misc-activity; sid:25455; rev:2;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION obfuscated document command"; flow:to_client,established; file_data; content:"|22|doc|22 2B 22|ument|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:trojan-activity; sid:25592; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION non-alphanumeric javascript detected"; flow:to_server,established; content:"+!![]"; content:"+!![]"; distance:0; content:"+!![]"; distance:0; content:"+!![]"; distance:0; metadata:policy security-ips drop, service http; reference:url,patriciopalladino.com/blog/2012/08/09/non-alphanumeric-javascript.html; classtype:attempted-user; sid:23831; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION non-alphanumeric javascript detected"; flow:to_client,established; file_data; content:"+!![]"; content:"+!![]"; distance:0; content:"+!![]"; distance:0; content:"+!![]"; distance:0; metadata:policy security-ips drop, service http; reference:url,patriciopalladino.com/blog/2012/08/09/non-alphanumeric-javascript.html; classtype:attempted-user; sid:23832; rev:3;)
alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"INDICATOR-OBFUSCATION large number of calls to char function - possible sql injection obfuscation"; flow:established,to_server; content:"GET"; http_method; content:"CHAR("; nocase; http_uri; pcre:"/[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(.*?[^R]CHAR\(/smiU"; metadata:policy balanced-ips drop, policy security-ips drop, service http; reference:url,isc.sans.org/diary.html?storyid=3823; classtype:web-application-attack; sid:25783; rev:1;)
# alert udp $HOME_NET any -> any 53 (msg:"INDICATOR-OBFUSCATION DNS tunneling attempt"; flow:to_server; byte_test:1,!&,0xF8,2; content:"|00 01 00 00 00 00 00 00 1A|"; depth:9; offset:4; content:"|1A|"; within:1; distance:26; content:"|02|"; within:2; distance:26; metadata:policy security-ips drop, service dns; classtype:policy-violation; sid:25983; rev:1;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION fromCharCode seen in exploit kit landing pages"; flow:to_client,established; file_data; content:"|22|f|22|+|22|ro|22|+|22|mCh|22|+|22|arCode|22|"; fast_pattern:only; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:trojan-activity; sid:26092; rev:1;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"INDICATOR-OBFUSCATION String.fromCharCode concatenation"; flow:to_client,established; file_data; content:"|22|fro|22|+|22|mC|22|+|22|harCode|22|"; fast_pattern:only; metadata:impact_flag red, policy balanced-ips drop, policy security-ips drop, service http; reference:url,malware.dontneedcoffee.com/2013/03/hello-neutrino-just-one-more-exploit-kit.html; classtype:trojan-activity; sid:26101; rev:1;)
